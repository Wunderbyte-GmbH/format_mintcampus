{"version":3,"file":"comment_delete.min.js","sources":["../src/comment_delete.js"],"sourcesContent":["/**\n * Mintcampus Course Format - Comment Management\n *\n * This module manages the deletion of course comments within the Mintcampus format.\n * It provides functionalities such as confirmation modals, AJAX requests, and \n * DOM updates to remove deleted comments dynamically.\n *\n * @package    format_mintcampus\n * @version    Refer to '$plugin->version' in the version.php file.\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later.\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/modal_factory', 'core/modal_events', 'core/pending'],\n    function ($, Ajax, Notification, Str, ModalFactory, ModalEvents, Pending) {\n\n        /**\n         * Initializes the delete comment functionality by attaching event listeners\n         * to dynamically loaded elements and handling comment deletions via AJAX.\n         * \n         * @method init\n         * @private\n         */\n        const init = function () {\n            console.log(\"Delete comment module initialized\");\n\n            var pendingPromise = new Pending('format_mintcampus/comment_delete:init');\n\n            // Attach event listener for dynamically added elements with data-commentid\n            $('body').on('click', '[data-commentid]', function () {\n                const commentid = $(this).data('commentid');\n                console.log(\"Delete button clicked for comment ID:\", commentid);\n\n                // Trigger custom event with the comment ID\n                $(this).trigger('deleteComment', { commentid: commentid });\n\n                // Display confirmation modal before proceeding with deletion\n                ModalFactory.create({\n                    title: Str.get_string('confirmdeletion', 'format_mintcampus'),\n                    body: Str.get_string('confirmdeletecommentmsg', 'format_mintcampus'),\n                    type: ModalFactory.types.SAVE_CANCEL\n                }).then(function (modal) {\n                    modal.setSaveButtonText(Str.get_string('delete', 'core'));\n                \n                    // Handle delete confirmation event\n                    modal.getRoot().on(ModalEvents.save, function (e) {\n                        e.preventDefault();\n                \n                        // Perform AJAX request to delete the comment\n                        Ajax.call([{\n                            methodname: 'format_mintcampus_delete_comment',\n                            args: { commentid: commentid }\n                        }])[0].then(function (response) {\n                            if (response.status === 'success') {\n                                Notification.alert(\n                                    Str.get_string('deletionsuccess', 'format_mintcampus'),\n                                    Str.get_string('commentsuccessfullydeleted', 'format_mintcampus'),\n                                    Str.get_string('close', 'format_mintcampus')\n                                );\n\n                                // Remove the closest .comment-item element from the DOM\n                                $(`[data-commentid=\"${commentid}\"]`).parents('.comment').fadeOut(300, function () {\n                                    setTimeout(() => $(this).remove(), 300);\n                                });\n\n                                // Close the modal upon successful deletion\n                                modal.hide();\n                            } else {\n                                Notification.alert(\n                                    Str.get_string('deletionerror', 'format_mintcampus'),\n                                    response.message,\n                                    Str.get_string('close', 'format_mintcampus')\n                                );\n                            }\n                        }).fail(function(error) {\n                            Notification.exception(error);\n                        }).always(pendingPromise.resolve);\n                    });\n                \n                    // Cleanup modal instance when closed\n                    modal.getRoot().on(ModalEvents.hidden, function () {\n                        modal.destroy();\n                    });\n                \n                    modal.show();\n                }).catch(Notification.exception);                \n            });\n\n            // Custom event listener for comment deletion trigger\n            $('body').on('deleteComment', function (event, data) {\n                console.log('Custom deleteComment event triggered for comment ID:', data.commentid);\n            });\n        };\n\n        return {\n            init: init\n        };\n    }\n);\n"],"names":["define","$","Ajax","Notification","Str","ModalFactory","ModalEvents","Pending","init","console","log","pendingPromise","on","commentid","this","data","trigger","create","title","get_string","body","type","types","SAVE_CANCEL","then","modal","setSaveButtonText","getRoot","save","e","preventDefault","call","methodname","args","response","status","alert","parents","fadeOut","setTimeout","remove","hide","message","fail","error","exception","always","resolve","hidden","destroy","show","catch","event"],"mappings":";;;;;;;;;;;AAYAA,0CAAO,CAAC,SAAU,YAAa,oBAAqB,WAAY,qBAAsB,oBAAqB,iBACvG,SAAUC,EAAGC,KAAMC,aAAcC,IAAKC,aAAcC,YAAaC,eAgFtD,CACHC,KAxES,WACTC,QAAQC,IAAI,yCAERC,eAAiB,IAAIJ,QAAQ,yCAGjCN,EAAE,QAAQW,GAAG,QAAS,oBAAoB,iBAChCC,UAAYZ,EAAEa,MAAMC,KAAK,aAC/BN,QAAQC,IAAI,wCAAyCG,WAGrDZ,EAAEa,MAAME,QAAQ,gBAAiB,CAAEH,UAAWA,YAG9CR,aAAaY,OAAO,CAChBC,MAAOd,IAAIe,WAAW,kBAAmB,qBACzCC,KAAMhB,IAAIe,WAAW,0BAA2B,qBAChDE,KAAMhB,aAAaiB,MAAMC,cAC1BC,MAAK,SAAUC,OACdA,MAAMC,kBAAkBtB,IAAIe,WAAW,SAAU,SAGjDM,MAAME,UAAUf,GAAGN,YAAYsB,MAAM,SAAUC,GAC3CA,EAAEC,iBAGF5B,KAAK6B,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,CAAEpB,UAAWA,cACnB,GAAGW,MAAK,SAAUU,UACM,YAApBA,SAASC,QACThC,aAAaiC,MACThC,IAAIe,WAAW,kBAAmB,qBAClCf,IAAIe,WAAW,6BAA8B,qBAC7Cf,IAAIe,WAAW,QAAS,sBAI5BlB,EAAG,oBAAmBY,eAAewB,QAAQ,YAAYC,QAAQ,KAAK,WAClEC,YAAW,IAAMtC,EAAEa,MAAM0B,UAAU,QAIvCf,MAAMgB,QAENtC,aAAaiC,MACThC,IAAIe,WAAW,gBAAiB,qBAChCe,SAASQ,QACTtC,IAAIe,WAAW,QAAS,yBAGjCwB,MAAK,SAASC,OACbzC,aAAa0C,UAAUD,UACxBE,OAAOnC,eAAeoC,YAI7BtB,MAAME,UAAUf,GAAGN,YAAY0C,QAAQ,WACnCvB,MAAMwB,aAGVxB,MAAMyB,UACPC,MAAMhD,aAAa0C,cAI1B5C,EAAE,QAAQW,GAAG,iBAAiB,SAAUwC,MAAOrC,MAC3CN,QAAQC,IAAI,uDAAwDK,KAAKF"}